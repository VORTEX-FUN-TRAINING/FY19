---
marp: true
---

<!-- page_number: true -->
<!-- $theme: defalut -->
<!-- $size: 16:9 -->

FY19 VORTEX FUNトレーニング
Pythonスキルアップチーム勉強会
==

## 第3回
2019.11.20

---

本日のアジェンダ
=
tocaroボットサンプルの紹介
難易度別tocaroボット作成例

---

tocaroボットサンプルの紹介
==

---

tocaroボット作ってきました
==
- はるか（嫁）の言い間違いをtocaroに投稿するボットです
- 一方的にしゃべるだけでこちらの話は聞いてくれません
- 自動投稿はまだ仕込んでないのでスクリプトを実行しないと投稿しません
- 動かしてみます

---

中身
==
![60%](./block_diagram.png)

---

仕組み
==
- HarukasQuotes.txtに言い間違いをテキストで記載
  - １行１言い間違いです
- quote_provider_by_file.pyでHarukasQuotes.txtを読み込んで内容を保持
  - 言い間違いを取得するget_quote()メソッドを持つ。呼び出されると、言い間違いをランダムで選んで、番号と一緒に辞書で返す
- tocaro_handler.pyは、tocaroに投げるjsonのデータ構造と、tocaroのURLにPOSTするためのメソッドを持つ
  - jsonに値を入れて、send2tocaro()メソッドを実行するとtocaroに投稿される
- 上記各モジュールをmain.pyから利用している
    - main.pyをcronとかaws lambdaとかで動かせば自動投稿できる

---

tocaroボットに必要な機能
==
### メッセージを投げるだけの場合
- tocaroへの投稿機能
- 投稿データ用のデータ保持機能
- 投稿データの追加、変更、削除の方法 
### チャットボットにしたい場合
- tocaroに入力されたメッセージを受け取るAPI
- APIが受け取ったメッセージを解析して処理する機能

---

難易度別tocaroボット作成例
==
- いきなりボット作れとか言われても困りますよね＾＾；
- ボットの作成例を、難易度別に紹介します

---

最低難易度：片方向＆データベースなし＆lambdaなし版
==
- tocaroに一方的にメッセージを送付するボットです
- メッセージはテキストファイルなどにおきます
- 自動でのメッセージ投稿にはダッサいcronを使います
### メリット
- データベースを使わないので気楽に作れる
- クラスだのモジュール化だの知らなくても動くものが多分できる 
### デメリット
- cronというダサい仕組みを使うことになるので、EC2インスタンス代が余分にかかる。誰が払ってると思ってるんだ！ヽ(`Д´)ﾉﾌﾟﾝﾌﾟﾝ

---

低難易度：片方向＆データベースあり＆lambdaなし版
==
- tocaroに一方的にメッセージを送付するボットです
- 投稿情報の管理にデータベース(RESTAPI)を使います
- 自動でのメッセージ投稿は、ダッサいcronを使います
### メリット
- RESTやデータベースの知識を得ることができる
### デメリット
- cronというダサい仕組みを使うことになるので、EC2インスタンス代が余分にかかる。誰が払ってると思ってるんだ！ヽ(`Д´)ﾉﾌﾟﾝﾌﾟﾝ

---

中難易度：片方向＆データベースあり＆lambdaあり版
==
- tocaroに一方的にメッセージを送付するボットです
- AWS lambdaを使って自動でtocaroに投稿します
### メリット
- lambdaを使うので、投稿用のEC2インスタンス代がかからない
- AWSのモダンなアーキテクチャを体験できる
### デメリット
- lambdaとcloudwatch eventsの学習コストがかかる

---

高難易度：双方向＆データベースあり＆lambdaあり版
==
- tocaroからコマンドを受け付け、適切なメッセージを返すボットです
- コマンドの受付と解析部分を実装する必要があります
### メリット
- インパクトのあるボットを作れる
- それなりに高度なPythonコードを書くことになる
### デメリット
- tocaroからアクセスするRESTAPIサーバを構築する必要がある
- tocaroから送信するコマンドの仕様などの設計が必要になる
- tocaroの仕様のせいで、SSLv3を受けるサーバを立てて独自ドメインとSSL証明書を取得しないといけない

---

tocaroボット相談コーナー
==

---

webアプリケーションとは
==
- webブラウザで利用できるアプリケーションのこと
- 何かを入力してその結果が反映されるようなwebサイトはwebアプリと呼べる
  - webメール、ECサイト、ブログ（の管理画面）、SaaS系などなど
  - コンテンツが置いてあるだけのwebサイトはwebアプリとは呼ばない
### そもそもアプリケーションとは
- OSにインストールして使う、ソフトウェアのこと
- コンピュータを利用する＝アプリケーションを利用する
- webブラウザで利用するwebアプリに対し、OS上で直接動いているアプリを「ネイティブアプリ」と呼ぶ  

---

アプリケーションとデータベースの関係
==
- アプリケーションは、必ずなにかしらのデータを扱っている
  - 商品情報とか、買い物かごの中身とか、在庫情報とか、顧客情報とか・・・
- データは、データベースに置かれる
- データベースを直接操作しても、情報を扱うことはできる
  - SQL文を駆使して、欲しい商品を探し出して買い物かごに入れることは出来るだろう
- でも、それでは扱いにくい！
- データベースの操作をさせつつ、人間が操作しやすい画面を提供するソフトウェアがあればよいのでは＝アプリケーションの誕生
### アプリケーションとは、データベースを扱いやすくするためのもの

---

webアプリケーションの歴史
==
### CGIの時代
- webサーバ内でPerlスクリプトを動かす
- アクセスカウンターとか、掲示板など
### アプリケーションサーバの時代
- DBとJavaなどを利用して、動的にHTMLを作成した
- 業務アプリやECサイトなどでは現在でもよく使われる
### モダンwebアプリの時代
- JavaSctiptをwebブラウザ内で動かす、リッチなwebアプリ
- サーバはデータベースと静的コンテンツだけを提供する　

---

モダンwebアプリの構造
==


---

RESTとRESTAPI
==
- web経由でデータベースにアクセスする場合、RDBMS用のポートをインターネット経由で開けるわけにはいかない
  - SQLは自由度が高いので危険
  - パスワード認証しかない
- web経由でデータベースにアクセスできるようにデータベースのテーブルをURLに対応付けたのがRESTAPI
> REpresentational  State Transfer API
> 本当はもっと細かい話があるのですが今回は割愛します
- HTTPメソッドで、データの読み書き・更新・削除（CRUD)を表現する 

---

RESTAPIの例
==
- データベースのテーブル定義がこんな場合

|id|kakugen|ittahito|
|:-|:-|:-|
|1|明日死ぬかのように生きよ。永遠に生きるかのように学べ|ガンジー|
|2|10%の才能と20%の努力、30%の臆病さと、残る40%は、運、だろうな|デューク東郷|

- 格言を読み込みたい場合
```
GET /kakugen/1
```

- 格言を追加したい場合
```
POST /kakugen
```

---

---

データベースの紹介
==

---

フレームワークとは
==



---



--