<!-- page_number: true -->
<!-- $size: 16:9 -->


FY19 VORTEX FUNトレーニング
Pythonチーム勉強会
==
第1回
2019.9.28

---

本日のアジェンダ
==

---

Pythonおさらい
==

---
Pythonとは　その１
==
- 1989年、オランダ人エンジニアであるグイド・ヴァン・ロッサム氏が発案、開発
- 「クリスマス休暇の暇つぶし」が開発のきっかけ
- 名称は、イギリスBBCのコメディ番組「空飛ぶモンティ・パイソン」から。本人が熱烈なファンとのこと
- マスコットはニシキヘビ（英語でPython）
- オープンソースプロジェクトであり、利用は無料
- オープンソースプロジェクトのリーダーに与えられる称号「優しい終身の独裁者」を最初に得た人物はこのグイド氏。なお2018年7月に引退している
- 科学技術計算や機械学習用ライブラリが充実しており、これらのジャンルでは事実上、標準言語となりつつある
- OpenStack / ansible / yum などの著名なOSSの開発言語でもある

---

Pythonとは　その２
==
- CLIだけでなく、GUIを持つアプリケーションの開発も可能
- 強い動的型付けのインタプリタ型スクリプト言語（コンパイルが不要）
- { }などのカッコでなく、インデントでループや条件分岐の範囲を表現する
- 推奨される書式が規格化されているため、誰が書いても近い見た目になる＝コードが読みやすい
- インタプリタは、C言語で実装されたCPythonが最も一般的だが、Javaで実装されたJython、.NETで実装されたIronPythonなどがある
- 動作速度は十分高速だが、JavaやCと比較すると5~10分の1程度遅いとされる。ただし、静的型付けをするCython(CPythonではない)では、Cに匹敵する速度が出せるとされる

---

Pythonのバージョン
==

- 現在使われているPythonには、バージョン２系と３系がある
- バージョン３では、利便性の向上やバージョン2での問題が解決された。が、
- バージョン２と３の間には**互換性がない**ので注意
- バージョン２系の最終は2.7で、２０２０年１月でサポートが終了
- RedHat系Linuxは最新版でもPython2が標準（yumなどはPython2で実装）
- 最新のUbuntu,Fedoraなどの先進LinuxではPython3が標準
	> Python2が入っていないのでオプションを付けないとansibleが動かなかったりする
## Pythonはバージョン３系を使いましょう！！
- 参画した案件でPython2を使っていたら、設計担当のSEは無能です。速やかに離脱しましょう。
- どうしても抜けられない場合は、Python3との互換性を保つ仕組みが沢山あるのでそれを使いましょう（今回は割愛）


---


Pythonプログラミングを始めよう
==

---

基本3構造
==
- どんな複雑なプログラムも、以下の3つの構造の組み合わせで動いている
## 順次処理
- 上から順番に処理を実行する

## 条件分岐
- 条件よって処理を選択する
 
## 繰り返し
- 同じ処理を繰り返し実行する

> 人間も同じですね

---

基本3構造のわかり易い例
==

## fizzbuzzプログラム
```
for i in range(1, 101):
    if i % 15 == 0:
        print("Fizz Buzz!")
    elif i % 3 == 0:
        print("Fizz!")
    elif i % 5 == 0:
        print("Buzz!")
    else:
        print(i)
```
- 変数 i が101になるまでiを1づつ増加　（for文、繰り返し）
- i が15、5、3で割り切れたら、それぞれの処理を実行（if文、条件分岐）
- 上記の処理を上から順に実行する（順次処理）

---


変数とは
==

```
print(1+1)
```
### 上記のプログラムは無意味だ。理由は・・・
- 1+1の計算結果を表示することしかできない
```
a = 1
b = 1
print(a+b)
```
### 上記のプログラムは無意味ではない
- 好きな値２つの合計を得られる
## 好きな値を好きなタイミングで入れられる箱、それが変数

---

変数の型
==
- 「1と1を足す」場合、1と数字と見るか文字と見るかで結果が全然違う
	- 数字の場合・・・2
	- 文字の場合・・・11
- 変数の中の値をどう扱うかを決めるため、変数には「型」が必要
- Pythonは「強い動的型付け」言語。つまり・・・
	- 動的型付け・・・変数を宣言したときに型を決める必要がない=実行時にインタプリタがよしなに調べてくれる
	- 強い・・・異なる型同士を計算することはできない。
- Pythonが遅いと言われる理由は、動的型付けであるがゆえに、ループや関数の呼び出しなどの際にインタプリタによる型の確認が行われるから 

---
変数の型（具体例）
==

#### Java（静的型付け言語）の例
- 予め型を宣言しておく必要がある
```java
int a=1;
String b="hoge";
```

#### Pythonでは
- 入れた値によって型が自動で決まる
```Python
a = 1  ##数値を入れたのでaは数値型になる
b = "hoge" ##文字（""で囲む）を入れたのでbは文字列型になる
```
- どちらの言語も、aとbは型が違うので計算することはできない
- ちなみに「弱い動的型付け」言語であるJavaScriptでは計算可能


---

Pythonの変数型
==

### 文字列	
- "（もしくは'）で囲った値を代入した変数は文字列型になる
```Python
moji = "hoge"
suji = "123"
kanji = "風林火山"
```
### 数値型
- 数字を""('')で囲まずに代入した場合は数値として扱われる
```Python
int = 123 ##整数型
float = 123.0 ##浮動小数点型
```
- Python3のint型は64ビット以上の桁も扱える
---

値のまとまりを扱う型
==
- 1つの変数で複数の値を扱いたい場合に使用する。正確には「コレクション」と呼ぶ。
- 変数には、好きな型の変数を好きなだけ入れられる。入れ子することもできる。

### リスト
- いわゆる配列。[]で囲む。順序があり、任意の位置の任意の個数の値を取り出せる。
```
list = [1,2,3,"a","b",[4,5]]
```
### タプル
- 中身を変えることができないリスト。()で囲む。リストよりも軽量で、高速に動作する。
```
tuple = (1,2,3,"a","b"(4,5))
```
> 実際には、（）で囲まなくても「,」で区切るとタプルになる
---

値のまとまりを扱う型（つづき）
==

### 辞書
- キーと値をセットにしたもの。{}で囲む。順序は決められない。キーは重複してはいけない。
```
dictionary = {"key":"value","a":1,"list":[1,2,3]}
```
> 順序を決められるOrderedDictというものもある
### 集合（セット）
- 重複しない値が入る。辞書をキーだけにしたイメージ。重複要素を除いたり、他の集合と集合演算して要素を取り出したりするのに使う
```
set = {1,2,3,"a","b"}
```

---
型の変換
==
- Pythonの型付けは「強い」ので、違う型同士の計算の際は型変換が必須になる
#### 例１　数値から文字への変換
- ユーザーIDがint型だけどそれを使ってRESTAPIを叩きたい時など
```
uid = 10 ## int型
url = "/user/"+str(uid)+"/info" ## /users/10/infoという文字列になる
```
#### 例２　リストから集合に変換
- リストの要素の積集合を取りたいときなど
```
male = ["jin","takashi","chisato"]
female = ["chisato","madoka","risako"]
male_set = set(male) ## 男性名の集合ができる
female_set = set(female) ## 女性名の集合ができる
male_set & female_set ##{"chisato"}
```
---

Pythonの定数
==
- 予め定義済みの定数がある。
#### None
#### True/False

---


イテレータ
==
- コレクションをfor文などで扱うと、持っている値を順に取り出してくれる
#### listリストに入っている1,2,3を順に表示する場合
```
list = [1,2,3]
for i in list:
  print(i)
```
- この場合、listのことをイテレータと呼ぶ
- タプル、集合、辞書はもちろん、文字列もイテレータ。数値型はイテレータではない

##### （参考）イテレータを知らなかった場合の残念なforループ
```
for i in range(0,len(list)):
    print(list[i])
```
---

関数
==
- ある入力を与えると出力を返す、処理のカタマリのこと	
### 関数を使うとき
##### 何度も出てくる同じ内容の処理を共通化したいとき
- 同じ処理が何度も出てくるコードは読みにくいしメンテナンス性も低い
- ただし、共通化した関数の変更はリスクが大きい。単体テストを書くことが大事
##### ifやループが深くなってきた時
- 他人（数カ月後の自分を含む）は、3重を超えるif文を簡単に理解できないと言われる
- ifが深くなりそうなら、関数で外出ししたほうがよい
##### 処理を部品化したいとき
- 関数にすることで、モジュールとしてimportできるようになる


---
- 引数
-位置引数
- キーワード引数

---

クラス・モジュール・パッケージ・ライブラリ
==
#### クラス
- 関連性のある処理の集まりや、データ構造や、データ構造に対して行う処理などをまとめたもの
> クラスについては次回詳しく解説するので今日のところは適当な理解でOKです
#### モジュール
- ファイルに書かれたPythonコードのこと。モジュール内のコードは、importすることで他のPyhtonコードから呼び出して利用できる
#### パッケージ
- 複数のモジュールを集めた名前空間。パッケージ名を一意にすることで、モジュール名の衝突を気にしないでよくなる
#### ライブラリ
- 複数のパッケージを集めたもの

---

pipについて
==
- Python標準のライブラリ管理ツール
- 

---
Pythonのプログラムの構造について
==

### 部品（関数やクラス）と、それを利用するメイン処理に分けましょう
```
class MogeClass:
    def parts1(hoge):
        # hogeの処理
        return fuga

     def parts2(moge):
        # mogeの処理
        return piyo

def _main():
    moge = MogeClass()
    a = moge.parts1('spam')
    b = moge.parts2('ham')
    # aとbの処理
    # 画面出力とか

if __name__ == '__main__':
    _main()
```

---

Pythonのプログラムの構造について（つづき）
==




---

開発環境のススメ
==

---

開発環境とは
==

- プログラムを開発しやするするためのアプリケーションのこと
- 昨今ではIDE（統合開発環境）と呼ばれ、プログラムの作成、GUIのデザイン、コンパイル、実行、デバッグ、製品としてパッケージ化するなどの豊富な機能を持つ
### IDEちょっと紹介
- Eclipse
	- Javaの無料開発環境として有名。プラグインが豊富。
- Intellij IDEA
	- JetBrains社によるIDE。 Java以外に、Pycharm（Python）,WebStorm(PHP/HTML)などの派生品がある。無料でもかなり高機能

---

なるべく「開発環境」を使おう
==
- サクラエディタや無垢なvimでもいいんですが・・・
	> ちなみにちゃんとvimはカスタマイズすると強力なIDEになります

### IDEを使った方がよい理由
- コード補完が効く　→　構文エラーなどを防げる、調べる時間を短縮できる
- シンタックスハイライトが効く　→　カッコの閉じ忘れ、スペルミスなどを防げる
- 開発→実行→デバッグの流れが非常にスムーズ
- なんかかっこいい

---

AWS Cloud9の紹介
==

- 本勉強会では、AWSのサービスである「Cloud9」を利用します

![](./cloud9.png)
- かっこいい！ 

---

AWS Cloud9の特徴
==

- webブラウザさえあればどこでもIDEを実行できる。IDEのインストールやメンテナンスは一切不要
- JavaScript、Python、PHP などの一般的なプログラム言語に対応
- 複数人で同時にコード編集が可能
- 標準で、git / docker / SAM（ServerlessApplicationModel）を提供。チーム開発、単体テストなどをcloud9だけで実施可能
- ターミナルを持つので、sshターミナルの代用としても使える
- Cloud9自体の利用料金は無料。Cloud9の動くEC2にだけ課金される

---

Python仮想環境のススメ
==

---

Python製アプリを使うときに起こりうる問題・・・
==
- Pythonで書かれたアプリケーションは、様々なライブラリを利用している事が多い＝依存関係がある
- 複数のPython製アプリを１つのマシン内で動かしたい場合、アプリが依存するライブラリのバージョンが異なったりして問題が起こることがある
	- あるライブラリAを利用するPythonアプリBとCがあったとき、AをバージョンアップしたらアプリCが動かなくなる・・・とか割とよくある	
- アプリが使うPythonのバージョンが違う場合、Pythonをフルパスで指定したり依存ライブラリの場所を指定したりと、結構めんどくさい・・・
> Python2アプリとPython3アプリが同じOSに混在してすることはよくありますね

## Pythonアプリを閉じ込めて、他のPythonアプリと環境が混ざらないようにしよう＝仮想環境

---

具体的にはこんな感じ
==

```
+-----------------------------------------------------+
| +---------------+ +--------------+ +--------------+ |
| |               | |              | |              | |
| |  Python3.7    | | Python2.7    | | Python3.4    | |
| |  ansible==2.8 | | ansible==1.9 | | ansible==2.4 | |
| |  Jinja2==2.10 | | Jinja2==1.15 | | Jinja2==2.11 | |
| |               | |              | |              | |
| |  仮想環境1     | |  仮想環境2     | |  仮想環境3    | |
| +---------------+ +--------------+ +--------------+ |
+-----------------------------------------------------+
```
- それぞれの環境は独立しており、Python自体やライブラリの変更が他の環境に影響を与えることはない
- 仮想環境１でpythonコマンドを実行するとPython3.7が起動するが、仮想環境２の場合はPython2.7が起動する
- ansibleをバージョンアップしたい時、共通のライブラリの依存関係や、既存のバージョンを意識しないで済む = **運用が楽**

---

仮想環境の種類
==
## virtualenv
- 元祖仮想環境（確か）。仮想環境で使うPythonのバージョンを指定することができる
## pyenv
- 未インストールのPythonバージョンをネットから自動で取得できる。パスの通し方が独特らしいのと、日本独自仕様のため嫌いな人も多い
## venv
- Python3.3からビルトイン。venvを実行したバージョンのPythonのみ利用可能。簡単なのでおすすめ。ただしPython3系のみ対応
## pipenv
- 最新型の仮想環境。詳細は後述。

---

とりあえずvenvを使ってみる
==
```
$ pip list
```
- インストールされたpipモジュールが沢山出てくるはず
```
$ python3 -m venv testenv
```
- testenvという仮想環境ができる。Pythonインタプリタは、Python3.7（実行したコマンドのバージョン）
```
$ source testenv/bin/activate
```
- これだけで、testenvの閉じた仮想環境に入る。プロンプトが変わっているはず
```
(testenv)$ pip list
```
- 最初のpip listの結果とは違うはずだ

---

とりあえずvenvを使ってみる
==



---
pipenvを使おう



---
git基礎
==

---
gitのない世界
==
例の写真を入れる

- どれが顧客に渡したものかわからない
- どれが最新かわからない
- 誰がどのファイルにどんな変更を加えたかがわからない
### ファイルサーバによるファイル共有では、チームでプロジェクトを進めるのが結構難しい

---
gitとは
==
- 分散ソースコードバージョン管理システム(SCM) 
- 誰が、いつ、どのファイルのどの行に、どんな変更を加えたかを管理する
- Linuxカーネルのソース管理のために、リーナス御大自らが開発
	- Linuxカーネルの開発者は世界に４万人いて、毎週2000を超える変更が加えられる。単なるファイルサーバではこのような開発案件の基盤になるのは不可能
	> 10日間雲隠れして開発したそう。名称は、３文字で、過去に使われてないものなら何でも良かったとのこと
- SCMには、他にSubversionやMercuralなどがあるが、事実上の標準となっている

---
gitとgithub
==
- gitで管理する





---
お疲れさまでした
==

### アンケートにご協力ください

#### アンケートURL

---

さぁ飯だ飯だ
==
- 休憩

---

午後の部　その１
==

### - githubのアカウントを取ろう！ -
- 今後、当Pythonチームでは、勉強会資料やコードのやりとりにgithubを利用します。アカウントの登録と、グループへの参加を今やっちゃいましょう
> すでにアカウントをお持ちの方は登録不要です。グループへの参加だけお願いしますm(_ _)m
1. 以下へGo!
```
https://github.com/
```
2. 個人メールを使って登録開始！
3. 

---


午後の部　その２
==

### - Pythonプログラミング実践 -
##  「世界のナベアツ」を作ってみよう！！

#### 要件
1. １〜１００までの数のうち、３の倍数と３が付く数の場合、表示がアホになる
	- 例１　2の場合・・・ 2	
	- 例２　3の場合 ・・・　サ〜ン！！
	- 例３　３３の場合・・・サンジュウサ〜ン！！
1. ナベアツ数を求める部分はモジュール化出来るようにすること（需要があるか知らないが他のコードから再利用したい）
1. 難しければ、まずは40まで。できれば1000まで作って欲しい

# OK, Let's code!

